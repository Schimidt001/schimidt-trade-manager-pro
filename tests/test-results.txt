# Terminal Full Output
# Terminal: test
# Command: cd /home/ubuntu/schimidt-trade-manager-pro && bash tests/run-tests.sh 2>&1
# PID: 5775
# Timestamp: 2026-02-08_15-34-15.275745
# Original Length: 6981 characters
# ----------------------------------------

Aguardando API em http://localhost:3099...
API pronta!
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1m[0;36m  TESTE 0 â€” Estado Inicial[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1;33mâ–¶ GET /ops/status â€” verificar estado inicial[0m
{
    "gate": "G0",
    "arm_state": "DISARMED",
    "global_mode": "NORMAL",
    "execution_state": "OK",
    "provider_states": {},
    "executor_connectivity": "unknown",
    "executor_status": {
        "connected": true,
        "timestamp": "2026-02-08T20:34:13.288Z",
        "mode": "SIMULATOR",
        "active_strategy": "NONE",
        "active_symbols": [],
        "risk_profile": {
            "max_risk_per_trade_pct": 2,
            "max_daily_loss_pct": 5,
            "max_positions": 8
        },
        "health": {
            "latency_ms": 25,
            "error_rate": 0,
            "execution_state": "OK"
        }
    },
    "mock_mode": true,
    "risk_off": false,
    "last_tick_result": null,
    "timestamp": "2026-02-08T20:34:13.288Z"
}
  [0;32mâœ… PASS: Gate inicial = G0[0m
  [0;32mâœ… PASS: Arm state inicial = DISARMED[0m
  [0;32mâœ… PASS: mock_mode = true (Entrega B)[0m
  [0;32mâœ… PASS: risk_off = false[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1m[0;36m  TESTE 1 â€” Tick Completo[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1;33mâ–¶ POST /ops/tick â€” executar tick com 4 sÃ­mbolos[0m
{
    "correlation_id": "fd7a3058-7178-4d49-9382-15000c7e6f9d",
    "timestamp": "2026-02-08T20:34:13.452Z",
    "gate": "G0",
    "commands_sent": false,
    "events_persisted": 28,
    "mock_mode": true,
    "summary": {
        "snapshots": 4,
        "intents": 4,
        "decisions": 4
    }
}
  [0;36mâ„¹ Correlation ID: fd7a3058-7178-4d49-9382-15000c7e6f9d[0m
  [0;36mâ„¹ Gate: G0[0m
  [0;36mâ„¹ Snapshots: 4 | Intents: 4 | Decisions: 4[0m
  [0;36mâ„¹ Events persisted: 28[0m
  [0;36mâ„¹ Mock mode: True[0m
  [0;32mâœ… PASS: MCL_SNAPSHOT gerado (4 snapshots)[0m
  [0;32mâœ… PASS: BRAIN_INTENT gerado (4 intents)[0m
  [0;32mâœ… PASS: PM_DECISION gerado (4 decisions)[0m
  [0;32mâœ… PASS: Eventos persistidos no ledger (28)[0m
  [0;32mâœ… PASS: Tick marcado como mock_mode=true (Entrega B)[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1m[0;36m  TESTE 2 â€” Gate Promotion (Entrega A)[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1;33mâ–¶ 2.1 â€” Tentar promover sem prÃ©-requisitos (antes do tick) â€” deve falhar com reason_code[0m
[1;33mâ–¶ 2.2 â€” Promover G0 â†’ G1 (apÃ³s tick com sucesso)[0m
{
    "status": "PROMOTED",
    "from_gate": "G0",
    "to_gate": "G1",
    "reason_code": "GATE_PROMOTED",
    "message": "Gate promovido de G0 para G1",
    "correlation_id": "12061161-cc27-4b2f-960c-c6692516c5c4"
}
  [0;36mâ„¹ HTTP Status: 200[0m
  [0;32mâœ… PASS: Gate promovido para G1 (reason_code: GATE_PROMOTED)[0m
[1;33mâ–¶ 2.3 â€” Verificar /ops/status apÃ³s promoÃ§Ã£o[0m
  [0;36mâ„¹ Gate atual: G1[0m
[1;33mâ–¶ 2.4 â€” Tentar transiÃ§Ã£o invÃ¡lida G1 â†’ G3 (deve falhar)[0m
  [0;36mâ„¹ HTTP Status para transiÃ§Ã£o invÃ¡lida: 409[0m
  [0;32mâœ… PASS: TransiÃ§Ã£o invÃ¡lida G1â†’G3 rejeitada com 409[0m
[1;33mâ–¶ 2.5 â€” Tentar promover com role Operator (deve falhar â€” requer Admin)[0m
  [0;36mâ„¹ HTTP Status com Operator: 403[0m
  [0;32mâœ… PASS: RBAC: Operator nÃ£o pode promover gate (403)[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1m[0;36m  TESTE 3 â€” ARM/DISARM/KILL[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1;33mâ–¶ 3.1 â€” ARM em G1 (deve funcionar)[0m
{
    "status": "ARMED",
    "gate": "G1"
}
  [0;36mâ„¹ HTTP Status: 200[0m
  [0;32mâœ… PASS: ARM em G1 funcionou (nÃ£o 409)[0m
[1;33mâ–¶ 3.2 â€” Verificar arm_state = ARMED[0m
  [0;32mâœ… PASS: arm_state = ARMED[0m
[1;33mâ–¶ 3.3 â€” DISARM[0m
  [0;36mâ„¹ HTTP Status: 200[0m
  [0;32mâœ… PASS: DISARM funcionou[0m
  [0;32mâœ… PASS: arm_state = DISARMED apÃ³s DISARM[0m
[1;33mâ–¶ 3.4 â€” ARM novamente para testar KILL[0m
[1;33mâ–¶ 3.5 â€” KILL (deve setar risk_off=true e DISARM)[0m
{
    "status": "KILLED",
    "arm_state": "DISARMED",
    "risk_off": true,
    "message": "Kill switch ativado. Sistema desarmado e em RISK_OFF."
}
  [0;36mâ„¹ HTTP Status: 200[0m
  [0;32mâœ… PASS: KILL executado com sucesso[0m
  [0;32mâœ… PASS: KILL â†’ arm_state = DISARMED[0m
  [0;32mâœ… PASS: KILL â†’ risk_off = true[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1m[0;36m  TESTE 4 â€” ExecuÃ§Ã£o Simulada (Entrega C)[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1;33mâ–¶ 4.0 â€” Preparar ambiente: resetar para G1 + ARMED[0m
  [0;36mâ„¹ PromoÃ§Ã£o para G1: HTTP 200[0m
  [0;36mâ„¹ Estado antes do tick: Gate=G1, ARM=ARMED[0m
[1;33mâ–¶ 4.1 â€” RUN TICK em G1+ARMED[0m
{
    "correlation_id": "6b840c67-a701-48bd-90e9-0be4a4e8a92c",
    "timestamp": "2026-02-08T20:34:14.617Z",
    "gate": "G1",
    "commands_sent": true,
    "events_persisted": 28,
    "mock_mode": true,
    "summary": {
        "snapshots": 4,
        "intents": 4,
        "decisions": 4
    }
}
  [0;36mâ„¹ Correlation ID: 6b840c67-a701-48bd-90e9-0be4a4e8a92c[0m
  [0;36mâ„¹ Commands sent: True[0m
  [0;36mâ„¹ Events persisted: 28[0m
  [0;36mâ„¹ Decisions: 4[0m
  [0;32mâœ… PASS: Commands sent = true em G1+ARMED[0m
  [0;32mâœ… PASS: PM_DECISION gerado (4 decisions)[0m
  [0;32mâœ… PASS: Eventos de execuÃ§Ã£o simulada persistidos (total: 28)[0m
[1;33mâ–¶ 4.2 â€” Verificar /ops/status.executor_status[0m
  executor_status: {
  "connected": true,
  "timestamp": "2026-02-08T20:34:15.129Z",
  "mode": "SIMULATOR",
  "active_strategy": "D2_M15",
  "active_symbols": [
    "BTCUSD"
  ],
  "risk_profile": {
    "max_risk_per_trade_pct": 2,
    "max_daily_loss_pct": 5,
    "max_positions": 8
  },
  "health": {
    "latency_ms": 25,
    "error_rate": 0,
    "execution_state": "OK"
  }
}
  executor_connectivity: connected
  mock_mode: True
  risk_off: True
  last_tick_result: {
  "has_mcl_snapshot": true,
  "has_brain_intent_or_skip": true,
  "has_pm_decision": true,
  "events_persisted": 28
}
  [0;32mâœ… PASS: Executor conectado (connectivity=connected)[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1m[0;36m  RESUMO FINAL[0m
[1m[0;36mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•[0m
[1mTotal de verificaÃ§Ãµes: 23[0m
[0;32mâœ… Passou: 23[0m
[0;31mâŒ Falhou: 0[0m
[0;32m[1mğŸ‰ TODOS OS TESTES PASSARAM![0m
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Entregas verificadas:
  A â€” Gate promotion institucional (POST /ops/gate/promote)
  B â€” Mock mode explÃ­cito (mock_mode + payload.mock + MOCK_*)
  C â€” ExecuÃ§Ã£o simulada evidenciada (EXEC_SIMULATED_*)
  D â€” UI/contratos: Replay/Calendar/Config claros
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•